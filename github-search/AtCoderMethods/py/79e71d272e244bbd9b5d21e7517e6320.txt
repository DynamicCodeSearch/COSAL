def F(X,D,N):Z=N and F((X*D+X)%M,D*D%M,N//2);return[Z,Z*D+X][N%2]